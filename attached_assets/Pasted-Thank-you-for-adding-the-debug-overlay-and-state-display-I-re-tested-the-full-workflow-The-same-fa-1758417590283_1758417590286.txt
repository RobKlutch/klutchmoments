Thank you for adding the debug overlay and state display. I re-tested the full workflow. The same failure persists in live playback. The spotlight continues to hang on the left side of the video surface instead of adhering to the selected player.

Summary

Environment: Replit, Video Preview stage.

Repro: Select player in Timeline. Open Preview. Play for 10 seconds.

Expected: Spotlight locks to the selected player and follows frame by frame.

Actual: Spotlight remains visible but detaches and drifts left during motion and occlusion. Behavior unchanged from prior builds.

Assessment

The visibility gate fix and new instrumentation are not addressing the end-to-end transform path. Logs show the correct selectedPlayerId, but the rendered overlay does not match the player position. This points to a coordinate pipeline or update-ordering error rather than selection state.

Action requested
Please escalate to senior engineering and deliver the following to close:

End-to-end coordinate audit

Single source of truth for coordinates: video frame space → normalized [0..1] → overlay pixels.

Confirm the video content rectangle used for drawing accounts for object-fit, letterboxing, CSS transforms, and devicePixelRatio.

Remove or mirror any transforms applied to the video container so the overlay’s draw space equals the video content rect.

Update loop ordering

One update loop only. Tracking state updated before overlay draw on each requestAnimationFrame.

Disable competing timers or stale state writers.

Strict ID-lock behavior

While selectedPlayerId is set, render only that ID’s bounding box.

If the box is temporarily missing, freeze last valid position for N frames rather than jumping or reverting to proximity.

Instrumentation proof in real playback

On-screen overlay must show for each frame: selectedPlayerId, raw detector box in video coordinates, transformed overlay box in pixels, videoRect, canvasRect, devicePixelRatio.

Provide a 20–30 second screen recording with the debug overlay enabled on the same clip we used to reproduce.

Acceptance criteria

Overlay IoU with the selected player’s box ≥ 0.6 for at least 95% of frames over a 10-second clip at 1080p.

Max positional error ≤ 20 pixels at 1080p.

Zero frames where the overlay is drawn outside the selected player while a valid box exists.

No edge sticking or left-anchoring during seeks or resizes.

Provide commit SHAs and a short test matrix across two devicePixelRatio values and two viewport sizes.

Interim safeguards requested

Clamp overlay to the computed video content rect.

Force top-left origin consistently or center consistently, not mixed.

Disable all proximity fallbacks while a player is selected.

Freeze last known good position for short gaps to avoid jumps.