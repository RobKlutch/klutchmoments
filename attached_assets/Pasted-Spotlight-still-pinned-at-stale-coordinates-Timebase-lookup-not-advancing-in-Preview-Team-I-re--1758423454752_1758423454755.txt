Spotlight still pinned at stale coordinates. Timebase/lookup not advancing in Preview.

Team,

I re-tested with the HUD enabled. The same failure persists.

Evidence from HUD (screenshot attached)

Timebase: currentVideoTime=0.000s, clipStartOffset=0.000s, sampleTime=0.000s, selectedActivationTime=5.939s.

ID-lock: selectedPlayerId=player_10, trackingBoxId=player_10, ID Match=YES.

Validity: hasValidBoxForSelected=YES, freezeActive=NO.

Render: isSpotlightActive=YES.

Position is constant: Pos=(0.021, 0.438) for the entire clip.

Diagnosis

The overlay is rendering a stale track sample at t=0.000s and never advancing with playback.

Either:

currentVideoTime/sampleTime are not updated from video.currentTime each frame, or

The ID→box join uses index 0 (or a fixed timestamp) instead of the nearest box at sampleTime, or

There is a unit mismatch (seconds vs milliseconds), so sampleTime never matches any box timestamps, defaulting to the first box.

Required fixes

Wire timebase correctly in rAF

On every requestAnimationFrame, read video.currentTime directly (not from stale React state):
const t = videoRef.current?.currentTime ?? 0; const sampleTime = t + clipStartOffset;

Store lastVideoTime and assert it increases during playback. If not, log an error and skip draw.

Perform per-frame ID lookup by time

For the selected ID: box = getBoxByIdAtTime(selectedPlayerId, sampleTime, { interpolate: true, window: 1/30 }).

If box exists, update position and reset freeze. If not, freeze last valid for N frames, then hide.

Do not fall back to proximity while a player is selected.

Unify timestamp units

Ensure sampleTime, selectedActivationTime, and all box.timestamp values are in the same units.

Display on HUD each frame: sampleTime, boxTimestamp, and abs(boxTimestamp - sampleTime).

Clear stale selection state on stage entry

When entering Preview, reset: isManuallySelected, lastBox, smoothing filters, framesSinceLastValid, and any freeze timer.

Require a fresh join to the track based on selectedActivationTime or live selection within Preview.

Single source of truth for render boolean

Compute once and use for both HUD and renderer:
isSpotlightActive = hasSelectedPlayer && (isManuallySelected || sampleTime >= selectedActivationTime) && hasValidBoxForSelected

Add an assertion: if HUD value ≠ renderer value, log inputs.

HUD fields required for verification

currentVideoTime, clipStartOffset, sampleTime

selectedPlayerId, trackingBoxId, ID Match

boxTimestamp, |boxTimestamp - sampleTime|

hasValidBoxForSelected, freezeActive, framesSinceLastValid

Final boolean used by the renderer: isSpotlightActive

Acceptance criteria to close

Overlay does not render at t=0 unless selection occurs in Preview.

After activation, overlay tracks only the selected player smoothly.

Quantitative: IoU ≥ 0.6 for ≥ 95% of frames over a 10-second clip at 1080p; max positional error ≤ 20 px; zero frames outside the player when a valid box exists.

Provide a 20–30 second recording with the HUD showing sampleTime and boxTimestamp advancing and trackingBoxId === selectedPlayerId throughout. Include commit SHAs.

This remains a blocker. Please implement the above, enable the HUD by default, and share the verification recording.