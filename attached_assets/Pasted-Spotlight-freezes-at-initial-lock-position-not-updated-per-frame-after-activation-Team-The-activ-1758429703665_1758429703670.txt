Spotlight freezes at initial lock; position not updated per frame after activation

Team,

The activation and ID-lock fixes got us closer, but a core bug remains:

Symptom

After activation, the spotlight immediately loses “stickiness” and stays pinned at the original lock coordinate for the rest of the clip.

The player’s ID and timestamps line up, yet the overlay position does not move frame-to-frame.

What this implies

The renderer is not using the per-frame box center from the selected player’s track. It appears to keep drawing from an initial anchor (manual click or t=0 sample) or from a stale closure/ref that never updates.

High-probability root causes

Position source bug: overlay uses selectionAnchorPos (or similar) instead of boxCenter once tracking is valid.

Stale state/closure: the rAF draw reads a position captured in a useCallback/closure that lacks boxCenter in its deps.

Freeze latch never releases: a “gap bridge” or “manual lock” flag continues to override live tracking.

Dual stores: Tracking Box updates one store, Spotlight reads another store that never updates after activation.

Equality short-circuit: a guard if (pos === lastPos) return; prevents updates because objects/tuples are reused.

Required fixes

Single source of truth for position. Every rAF:

sampleTime = video.currentTime + clipStartOffset

box = getBoxByIdAtTime(selectedPlayerId, sampleTime, { interpolate:true, window:1/30 })

boxCenterNorm = { x: box.cx, y: box.cy } when box exists

overlayPosPx = toPixels(boxCenterNorm, videoContentRect)

Never draw from the manual anchor while hasValidBoxForSelected is true. Manual selection only sets selectedPlayerId and seeds smoothing; it must not remain the render source.

rAF loop ownership. One rAF that does: read time → fetch box → compute position → smooth → draw. No competing timers.

Kill stale closures. Ensure any draw/update useCallback includes boxCenter, overlayPosPx, isSpotlightActive in its dependency list, or read from mutable refs updated each rAF.

Release freeze. Freeze applies only when no box for the selected ID for ≤N frames. When a valid box returns, resume live positions immediately.

Unify stores. Spotlight and Tracking Box must consume the exact same per-frame position provider.

HUD additions to prove the fix (keep on by default)

boxCenterNorm: (x,y) and overlayPosPx: (x,y) every frame.

ΔposPx/frame and lastUpdateFrameId to confirm movement and updates.

Flags: usingManualAnchor, usingFreeze, usingLiveBox, expected to be false/false/true after activation.

The final boolean used by the renderer: finalIsSpotlightActive.

Acceptance criteria

After activation, usingLiveBox=true, overlayPosPx changes every frame with the player’s motion.

No reversion to anchor/freeze while valid boxes exist.

Quantitative:

IoU with the selected player’s box ≥ 0.6 for ≥ 95% of frames over a 10-second 1080p clip.

Max positional error ≤ 20 px.

Zero frames where the overlay is outside the selected player while a valid box exists.

Provide a 20–30 s screen recording with the HUD showing boxTimestamp≈sampleTime, overlayPosPx moving each frame, and usingLiveBox=true throughout. Include commit SHAs.

This remains a blocker for Klutch. Please confirm a single owner and deliver the position-source unification plus the verification recording.